services:
  railpulse:
    # Use pre-built image from GitHub Container Registry
    image: ${IMAGE:-ghcr.io/secunit404/railpulse:latest}
    # Or uncomment below to build from source:
    # build:
    #   context: .
    #   dockerfile: Dockerfile
    container_name: railpulse
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:9876/api/health', (r) => process.exit(r.statusCode === 200 ? 0 : 1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    environment:
      - DATABASE_URL=${DATABASE_URL:-file:/app/data/railpulse.db}
      - JWT_SECRET=${JWT_SECRET}
      - TRAFIKVERKET_API_KEY=${TRAFIKVERKET_API_KEY}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:9876}
      - PORT=${PORT:-9876}
      - TZ=${TZ:-Europe/Stockholm}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - COOKIE_SECURE=${COOKIE_SECURE:-false}
      - COOKIE_SAMESITE=${COOKIE_SAMESITE:-lax}
    volumes:
      - ${DATA_DIR:-./data}:/app/data
    restart: unless-stopped
    user: "${PUID:-1000}:${PGID:-1000}"
    ports:
      - "${PORT:-9876}:${PORT:-9876}"
